# Kernel compiler / linker flags
CFLAGS := 				 \
	-I ../libs/			 \
	-I ../kernel/		 \
	-I arch/$(ARCH)/	 \
	-I $(PLATFORM_DIR)	 \
	-std=gnu11			 \
	-O2	-pipe -g		 \
	-ffreestanding       \
	-fno-stack-protector \
	-fno-pic             \
	-mno-80387           \
	-mno-mmx             \
	-mno-3dnow           \
	-fpie				 \
	-lgcc				 \
	-mno-sse			 \
	-mno-sse2			 \
	-Wall				 \
	-fno-omit-frame-pointer \
	-mno-red-zone

ASMFLAGS = -felf64 -g -F dwarf -I arch/$(ARCH)/

LDINTERNALFLAGS :=  \
	-T $(BUILD_DIR)/link/link_$(ARCH)_$(BOARD).ld \
	-static         \
	-pie			\
	--no-dynamic-linker \
	-ztext			\
	-zmax-page-size=0x1000 \
	-nostdlib      

arch_post_build:
	@printf "No post build step required\n"

$(TARGET): $(OBJ)
	@printf " LD  Linking object files\n";
	@ld -r -b binary -o font.o ../font.bin
	$(LD) $(LDINTERNALFLAGS) $(OBJ) $(KLIBS) ./trace/symtable.o font.o -o $@
	python3 ../scripts/gensym.py $@
	$(LD) $(LDINTERNALFLAGS) $(OBJ) $(KLIBS) ./trace/symtable.o font.o -o $@
	@$(MAKE) arch_post_build
